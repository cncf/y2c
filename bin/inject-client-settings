#!/usr/bin/env node

if (!process.env.GAE_SERVICE) {
  return
}

require('dotenv').config()
const path = require('path')
const { readFileSync, writeFileSync } = require('fs')
const { stringify } = JSON

const clientSettings = require(path.resolve(__dirname, '..','src', 'clientSettings'))
const indexPath = path.resolve(__dirname, '..', 'build', 'index.html')
const index = readFileSync(indexPath, 'utf8')
const newContent = index.replace(/REACT_APP_SETTINGS.*?<\/script>/s, `REACT_APP_SETTINGS=${stringify(clientSettings)}</script>`)
writeFileSync(indexPath, newContent)
