# y2c

## Description

Automatically import events from Github repos into Google Calendar.

## Overview

[Probot](https://probot.github.io) (GitHub App) that reads event data from specific YAML files (`y2c.yml`) in a GitHub repo and calls the Google Calendar API to create/update events. Event attendees can either be individual's email addresses, a Google Group email addresses or a groups.io groups. Note that when adding a new member to group.io won't automatically trigger an invitation to the new member.

## Not in scope

* Managing members of the Google Groups. If members need to be added to the Google Group, this will need to happen via the Google Groups UI.
* Creating/Updating events on groups.io

## Format of event files (`y2c.yml`)

```yaml
id: 'calendar-id'                   # automatically generated by y2c
organizer: 'dan@linuxfoundation.com' # email address of the organizer
calendarId: 'calendar-id'           # Calendar Identifier (required by Google)
title: 'Event title'
description: 'Event Description'
start:
  date: '2020-02-10'                # Event start date
  time: '9:00am'                    # Event start time
  timeZone: 'America/New_York'
end:
  date: '2020-02-10'                # Event end date
  time: '11:00am'                   # Event end time
  timeZone: 'America/New_York'
attendees:
  - email: joe@example.com          # Guest email
    name: 'Joe User'                # Guest name (optional)
  - email: jane@example.com
    name: 'Jane User'
```

#### Notes
* The user will have to specify the Calendar Identifier where the event will be created. The organizer must have access to that calendar.
* Not sure we care about setting attendee names.
* The description will include a link to the zoom meeting.

## Deployment

`y2c` will be deployed as a [Google Cloud Function](https://probot.github.io/docs/serverless-deployment/#google-cloud-function)

## Authorizing requests to the Google Calendar API

The Google Calendar API uses OAuth 2.0, in order to make requests to it from a GitHub App we will have to use [OAuth 2.0 for Server to Server Applications](https://developers.google.com/identity/protocols/OAuth2ServiceAccount). This requires creating a _Service Account_. If we want this _Service Account_ to create events in other users' calendars or on behalf of other users we will have to grant _domain-wide authority_ to the _Service Account_.

If CNCF and Kubernetes belong to the LF account on Google, we might be able to just authorize once `y2c` for LF and that would give access to both organizations. Otherwise, we will have to create a service account for each organization, obtain the respective private key files and add the files to `y2c`.

## Adding Probot to a GitHub repo

The Probot will be added to organizations (CNCF and Kubernetes for now), which will grant access to all repos in that org.

## Implementation of the Probot

At the higher level the Probot will:

* Receive webhook from Github repo and determine if it's a push on master that contains changes to `y2c.yml` files.
* For each `y2c.yml` file that changed check if the event data includes ID.
* If event data does not include ID:
    * Generate random ID.
    * Assign it to `y2c.yml` and commit file.
    * Create event on Google Calendar with the ID generated above.
* If event data includes ID, update event on Google Calendar.
